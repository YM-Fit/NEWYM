# ✅ ניהול כרטיסיות לקוחות - הושלם!

## מה נוצר?

### 1. תצוגת כרטיסיות לקוחות (`ClientsListView`)
- **מיקום**: `src/components/trainer/Clients/ClientsListView.tsx`
- **תכונות**:
  - הצגת כל הכרטיסיות מ-Google Calendar
  - סטטיסטיקות כוללות (סה"כ לקוחות, מקושרים, לא מקושרים, אירועים)
  - חיפוש לפי שם, אימייל או טלפון
  - סינון: הכל / מקושרים / לא מקושרים
  - רענון ידני

### 2. כרטיס לקוח (`ClientCard`)
- **מיקום**: `src/components/trainer/Clients/ClientCard.tsx`
- **תכונות**:
  - מידע בסיסי: שם, אימייל, טלפון
  - סטטיסטיקות אוטומטיות:
    - סה"כ אירועים
    - אירועים קרובים
    - אירועים שהושלמו
  - תאריכים: אירוע ראשון ואחרון
  - קישור למתאמן קיים
  - אינדיקטור סטטוס קישור

### 3. ספירה אוטומטית
הספירה מתעדכנת אוטומטית דרך:
- **`sync-google-calendar` Edge Function**: מעדכן ספירה בכל סנכרון תקופתי
- **`google-webhook` Edge Function**: מעדכן ספירה בזמן אמת כשמתרחש שינוי ב-Google Calendar

## איך זה עובד?

### 1. יצירת כרטיס לקוח
כשמתקבל אירוע חדש מ-Google Calendar:
- המערכת מחפשת את ה-identifier של הלקוח (אימייל או שם)
- אם הכרטיס לא קיים, הוא נוצר אוטומטית
- הספירה מתחילה מ-1

### 2. עדכון ספירה אוטומטי
לכל אירוע חדש/עודכן/נמחק:
- `total_events_count` - מתעדכן
- `upcoming_events_count` - מתעדכן לפי תאריך האירוע
- `completed_events_count` - מתעדכן לפי תאריך האירוע
- `first_event_date` - תאריך האירוע הראשון
- `last_event_date` - תאריך האירוע האחרון

### 3. קישור למתאמן
- ניתן לקשר כרטיס לקוח למתאמן קיים
- הקישור מתעדכן גם בכרטיס הלקוח וגם במתאמן

## איך להשתמש?

### גישה לתצוגת הלקוחות:
1. לחץ על "כרטיסיות לקוחות" בתפריט הצד
2. המערכת תטען את כל הכרטיסיות מ-Google Calendar

### קישור מתאמן:
1. בחר כרטיס לקוח שלא מקושר
2. בחר מתאמן מהרשימה הנפתחת
3. המערכת תקשר את הכרטיס למתאמן

### סנכרון:
- הסנכרון מתבצע אוטומטית דרך:
  - Webhooks (זמן אמת)
  - סנכרון תקופתי (כל שעה/יום)
- ניתן לבצע סנכרון ידני דרך הגדרות Google Calendar

## טבלת `google_calendar_clients`

```sql
- id: UUID
- trainer_id: UUID
- trainee_id: UUID (nullable) - קישור למתאמן
- google_client_identifier: TEXT - מזהה ייחודי ב-Google Calendar
- client_name: TEXT
- client_email: TEXT
- client_phone: TEXT
- first_event_date: DATE
- last_event_date: DATE
- total_events_count: INT - ספירה אוטומטית
- upcoming_events_count: INT - ספירה אוטומטית
- completed_events_count: INT - ספירה אוטומטית
- crm_data: JSONB - נתונים נוספים
```

## מה הלאה?

### אפשרויות הרחבה:
1. **פרופיל לקוח מפורט** - דף פרופיל עם היסטוריית כל האירועים
2. **דוחות CRM** - ניתוח ביצועים, תדירות אימונים, וכו'
3. **התראות** - התראות על לקוחות שלא הגיעו זמן רב
4. **עסקאות** - מעקב אחר חוזים ותשלומים

---

**✅ הכל מוכן לשימוש!**
