/*
  # מילוי הוראות ביצוע לתרגילים חסרים
  
  מיגרציה זו בודקת את כל התרגילים הגלובליים ומוודאת שיש להם הוראות ביצוע.
  אם תרגיל חסר הוראות, נוסיף הוראות בסיסיות.
  
  התרגילים הגלובליים הם אלה ששייכים לקבוצות שריר עם trainer_id = NULL
*/

DO $$
DECLARE
  exercise_record RECORD;
  exercise_count INTEGER;
BEGIN
  -- בדיקה ומילוי הוראות לכל התרגילים הגלובליים
  FOR exercise_record IN 
    SELECT e.id, e.name, mg.name as muscle_group_name
    FROM exercises e
    JOIN muscle_groups mg ON e.muscle_group_id = mg.id
    WHERE mg.trainer_id IS NULL
    AND (e.instructions IS NULL OR e.instructions = '')
  LOOP
    -- הוספת הוראות לפי שם התרגיל
    CASE exercise_record.name
      -- חזה
      WHEN 'לחיצת חזה כנגד מוט' THEN
        UPDATE exercises SET instructions = 'שכב על ספסל, כפות רגליים יציבות על הרצפה. אחוז את המוט מעט רחב מכתפיים, הורד לאט אל מרכז החזה בזמן שאיפה ודחוף חזרה כלפי מעלה בזמן נשיפה תוך שמירה על כתפיים לאחור וחזה פתוח.'
        WHERE id = exercise_record.id;
      
      WHEN 'לחיצת חזה בשיפוע חיובי' THEN
        UPDATE exercises SET instructions = 'שכב על ספסל בשיפוע חיובי (ראש גבוה מהרגליים). אחוז את המוט מעט רחב מכתפיים, הורד לאט לחלק העליון של החזה ודחוף חזרה כלפי מעלה, תוך שמירה על גב צמוד לספסל וכתפיים לאחור.'
        WHERE id = exercise_record.id;
      
      WHEN 'לחיצת חזה כנגד משקולות יד' THEN
        UPDATE exercises SET instructions = 'שכב על ספסל שטוח, משקולת בכל יד. התחל עם ידיים ישרות מעל החזה, כפות ידיים פונות קדימה. הורד את המשקולות לצדדים בקשת עד שתרגיש מתיחה בחזה, ואז קרב אותן חזרה מעל החזה תוך שמירה על מרפקים מעט כפופים.'
        WHERE id = exercise_record.id;
      
      WHEN 'פרפר במכונה' THEN
        UPDATE exercises SET instructions = 'שב או שכב במכונת פרפר, כשמרפקים מעט כפופים. הצמד את הידיות יחד מול החזה תוך כיווץ חזק של שרירי החזה, ולאחר מכן החזר לאט לנקודת ההתחלה תוך שליטה מלאה בתנועה.'
        WHERE id = exercise_record.id;
      
      WHEN 'קרוס אובר כבלים עליון' THEN
        UPDATE exercises SET instructions = 'הצב את הכבלים בגובה כתפיים או מעט מעל. צעד קדימה, כפות ידיים פונות מעט כלפי מטה. עם מרפקים כפופים קלות, משוך את הידיים בקשת קדימה ולמטה עד לפני מרכז החזה, כווץ את החזה והחזר לאט לנקודת ההתחלה.'
        WHERE id = exercise_record.id;
      
      WHEN 'מקבילים' THEN
        UPDATE exercises SET instructions = 'אחוז במקבילים ברוחב כתפיים. שמור על חזה פתוח והטיית גוף קלה קדימה. רד לאט עד שמרפקים בערך ב-90°, ואז דחוף חזרה למעלה תוך כיווץ חזק של החזה והיד האחורית.'
        WHERE id = exercise_record.id;
      
      -- גב
      WHEN 'מתח' THEN
        UPDATE exercises SET instructions = 'אחוז במוט המתח באחיזה רחבה מעט מכתפיים. משוך את בית החזה לכיוון המוט תוך שמירה על חזה פתוח ושכמות יורדות למטה ולאחור. הורד את הגוף לאט בשליטה מלאה מבלי ''ליפול'' כלפי מטה.'
        WHERE id = exercise_record.id;
      
      WHEN 'פולי עליון אחיזה רחבה' THEN
        UPDATE exercises SET instructions = 'שב בפולי עליון, אחוז במוט באחיזה רחבה. משוך את המוט לכיוון החזה העליון בזמן שאתה מוביל עם המרפקים מטה ואחורה, כווץ את שרירי הגב והחזר לאט את המוט למעלה בשליטה.'
        WHERE id = exercise_record.id;
      
      WHEN 'חתירה כנגד מוט בהטיית גו' THEN
        UPDATE exercises SET instructions = 'עמוד עם גב נייטרלי והטיית גו קדימה, ברכיים מעט כפופות. אחוז במוט באחיזה מעט רחבה מכתפיים, משוך את המוט לכיוון הבטן התחתונה תוך שמירה על מרפקים קרובים לגוף ושכמות נסגרות אחורה.'
        WHERE id = exercise_record.id;
      
      WHEN 'חתירה כבלים בישיבה' THEN
        UPDATE exercises SET instructions = 'שב זקוף מול מכונת חתירה. כפות רגליים על המשטח, גב זקוף וחזה פתוח. משוך את הידיות לכיוון הבטן תוך שמירה על מרפקים קרובים לגוף, כווץ את הגב והחזר באיטיות קדימה מבלי לעגל את הגב.'
        WHERE id = exercise_record.id;
      
      WHEN 'מסור (חתירה יד אחת)' THEN
        UPDATE exercises SET instructions = 'הנח ברך וכף יד אחת על ספסל, גב ישר ומקביל לרצפה. ביד השנייה אחוז במשקולת, תן לה לרדת מטה בכתף רפויה ואז משוך את המשקולת לכיוון הירך תוך שמירה על מרפק קרוב לגוף וכיווץ הגב.'
        WHERE id = exercise_record.id;
      
      WHEN 'דדליפט קלאסי' THEN
        UPDATE exercises SET instructions = 'עמוד עם רגליים ברוחב אגן, מוט קרוב לשוקיים. שמור על גב ישר, כופף ירכיים וברכיים והורד את המוט קרוב לגוף עד מתחת לברכיים. דחוף את הרצפה ברגליים, ישר ירכיים וברכיים יחד והרם את המוט חזרה לעמידה זקופה.'
        WHERE id = exercise_record.id;
      
      WHEN 'פשיטת גו' THEN
        UPDATE exercises SET instructions = 'שכב על ספסל ייעודי לפשיטת גו, כפות רגליים מקובעות. התחל בגו ישר, הנמך את בית החזה מטה בשליטה תוך שמירה על גב נייטרלי, ואז הרם את הגו חזרה עד לקו הגוף מבלי לקשתת יתר את הגב התחתון.'
        WHERE id = exercise_record.id;
      
      -- כתפיים
      WHEN 'לחיצת כתפיים כנגד מוט' THEN
        UPDATE exercises SET instructions = 'עמוד זקוף, אחוז במוט בגובה כתפיים באחיזה מעט רחבה. דחוף את המוט מעל הראש בקו ישר תוך שמירה על ליבה חזקה ובלי לקשת יתר את הגב התחתון, ואז הורד לאט חזרה לגובה סנטר/חזה עליון.'
        WHERE id = exercise_record.id;
      
      WHEN 'לחיצת כתפיים משקולות יד' THEN
        UPDATE exercises SET instructions = 'שב או עמוד זקוף, משקולת בכל יד בגובה כתפיים. דחוף את המשקולות כלפי מעלה בקשת קלה עד שידיים כמעט ישרות, ואז הורד באיטיות לגובה כתפיים תוך שליטה מלאה ומניעת נענוע גוף.'
        WHERE id = exercise_record.id;
      
      WHEN 'הרחקה לצדדים' THEN
        UPDATE exercises SET instructions = 'עמוד זקוף, משקולת בכל יד לצידי הגוף. הרחק את הידיים לצדדים עד לגובה כתפיים עם מרפקים מעט כפופים, שמור על שורש כף יד בקו עם הכתף, ואז הורד באיטיות חזרה מטה מבלי לתת למשקולות ''ליפול''.'
        WHERE id = exercise_record.id;
      
      WHEN 'כפיפה מלפנים' THEN
        UPDATE exercises SET instructions = 'עמוד זקוף, משקולת בכל יד מול הירכיים. הרם את המשקולות קדימה עד לגובה כתפיים תוך שמירה על מרפקים מעט כפופים, ולאחר מכן הורד באיטיות חזרה לנקודת ההתחלה.'
        WHERE id = exercise_record.id;
      
      WHEN 'חתירה אנכית' THEN
        UPDATE exercises SET instructions = 'אחוז במוט באחיזה צרה מעט מרוחב כתפיים. הרם את המוט כלפי מעלה לאורך הגוף עד לגובה החזה באמצעות משיכת המרפקים כלפי מעלה, ואז הורד באיטיות תוך שמירה על כתפיים רפויות ולא מכווצות יתר על המידה.'
        WHERE id = exercise_record.id;
      
      WHEN 'פייס פול' THEN
        UPDATE exercises SET instructions = 'חבר חבל לפולי בגובה פנים. אחוז בקצוות החבל, צעד מעט לאחור. משוך את החבל לכיוון המצח/אוזניים תוך פישוק הקצוות לצדדים, כווץ את השריר האחורי של הכתף והשכמות, והחזר באיטיות קדימה.'
        WHERE id = exercise_record.id;
      
      -- רגליים
      WHEN 'סקוואט' THEN
        UPDATE exercises SET instructions = 'עמוד עם רגליים ברוחב כתפיים, כפות רגליים מעט החוצה. שמור על חזה פתוח וגו זקוף, כופף ברכיים וירכיים והורד את האגן כאילו אתה יושב לאחור, עד שהירכיים לפחות מקבילות לרצפה. דחוף חזרה דרך העקבים לעמידה.'
        WHERE id = exercise_record.id;
      
      WHEN 'לחיצת רגליים' THEN
        UPDATE exercises SET instructions = 'שב במכונת לחיצת רגליים, כפות רגליים ברוחב כתפיים על הפלטה. הורד את המשקל על ידי כיפוף הברכיים עד שזווית של כ-90° נוצרת, ואז דחוף חזרה דרך העקבים בלי לנעול את הברכיים לגמרי.'
        WHERE id = exercise_record.id;
      
      WHEN 'מכרעים' THEN
        UPDATE exercises SET instructions = 'עמוד בפסיעה קדימה, רגל קדמית ורגל אחורית. רד מטה עד ששתי הברכיים בכ-90°, הברך הקדמית לא עוברת את קו האצבעות. דחוף דרך העקב הקדמי חזרה לעמידה וחזור עם הרגל השנייה.'
        WHERE id = exercise_record.id;
      
      WHEN 'פשיטת ברכיים במכונה' THEN
        UPDATE exercises SET instructions = 'שב במכונה, כפות רגליים מתחת לכריות. ישר ברכיים כלפי מעלה עד כמעט נעילה, תוך שמירה על גב צמוד למשענת, ואז הורד באיטיות חזרה מבלי לתת למשקל לנוח בין חזרות.'
        WHERE id = exercise_record.id;
      
      WHEN 'כפיפת ברכיים במכונה' THEN
        UPDATE exercises SET instructions = 'שכב על הבטן במכונה, עקבים מתחת לגלילים. כופף את הברכיים והבא את העקבים לכיוון העכוז תוך כיווץ שרירי הירך האחורית, ואז הורד באיטיות את המשקל חזרה.'
        WHERE id = exercise_record.id;
      
      WHEN 'דדליפט רומני' THEN
        UPDATE exercises SET instructions = 'עמוד עם מוט בידיים או משקולות, רגליים ברוחב אגן. עם גב נייטרלי, דחוף את האגן לאחור והורד את המשקל לאורך הרגליים עד שמתיחה מורגשת בגב הירך, ואז דחוף את האגן קדימה לחזרה לעמידה.'
        WHERE id = exercise_record.id;
      
      WHEN 'תאומים בעמידה' THEN
        UPDATE exercises SET instructions = 'עמוד במכונה או על מדרגה, כפות רגליים על הקצה ועקבים בחוץ. הורד את העקבים מטה עד למתיחה בשוק, ואז הרם את העקבים כמה שיותר גבוה על קצות האצבעות תוך כיווץ שרירי התאומים.'
        WHERE id = exercise_record.id;
      
      -- יד קדמית
      WHEN 'כפיפת מרפקים כנגד מוט' THEN
        UPDATE exercises SET instructions = 'עמוד זקוף, אחוז במוט באחיזה תחתית ברוחב כתפיים. שמור על מרפקים צמודים לגוף, כופף את המרפקים והעלה את המוט לכיוון הכתפיים, ואז הורד באיטיות חזרה מבלי לנוע בגב או בכתפיים.'
        WHERE id = exercise_record.id;
      
      WHEN 'כפיפת מרפקים משקולות יד' THEN
        UPDATE exercises SET instructions = 'עמוד זקוף, משקולת בכל יד בצידי הגוף. כפות ידיים פונות קדימה, כופף את המרפקים והעלה את המשקולות לכיוון הכתפיים, ולאחר מכן הורד באיטיות למטה בלי ''לזרוק'' את המשקל.'
        WHERE id = exercise_record.id;
      
      WHEN 'כפיפת מרפקים פטישים' THEN
        UPDATE exercises SET instructions = 'אחוז משקולת בכל יד באחיזת פטיש (כפות ידיים פונות אחת לשנייה). כופף את המרפקים מבלי להזיז את הכתפיים, הרם את המשקולות לכיוון הכתפיים והורד באיטיות חזרה.'
        WHERE id = exercise_record.id;
      
      WHEN 'כפיפת מרפקים בכיסא כומר' THEN
        UPDATE exercises SET instructions = 'שב על ספסל כומר, זרוע על משענת בזווית. אחוז במשקולת, התחל ממרפק ישר וכופף את המרפק כלפי מעלה עד שהשריר מתכווץ לחלוטין, ואז הורד את המשקולת באיטיות למטה לשליטה מלאה.'
        WHERE id = exercise_record.id;
      
      -- יד אחורית
      WHEN 'פשיטת מרפקים כבל עליון' THEN
        UPDATE exercises SET instructions = 'עמוד מול כבל עליון, כפות ידיים על המוט או החבל. שמור על מרפקים צמודים לצידי הגוף, פשק את המרפקים מטה עד ליישור מלא של הידיים, ואז החזר באיטיות עד כ-90° מבלי להרים את המרפקים למעלה.'
        WHERE id = exercise_record.id;
      
      WHEN 'לחיצת חזה אחיזה צרה' THEN
        UPDATE exercises SET instructions = 'שכב על ספסל, אחוז במוט באחיזה צרה מעט מרוחב כתפיים. הורד את המוט אל מרכז החזה ודחוף חזרה למעלה תוך דגש על עבודה של הטרייספס, שמור על מרפקים קרובים לגוף.'
        WHERE id = exercise_record.id;
      
      WHEN 'לחיצה צרפתית' THEN
        UPDATE exercises SET instructions = 'שכב על ספסל, אחוז במוט או משקולות מעל החזה. כופף את המרפקים והורד את המשקל לכיוון המצח או מאחורי הראש תוך שמירה על כתפיים יציבות, ואז ישר את המרפקים חזרה בנשיפה.'
        WHERE id = exercise_record.id;
      
      WHEN 'פשיטה מאחורי הראש' THEN
        UPDATE exercises SET instructions = 'שב או עמוד, משקולת אחת בשתי ידיים מאחורי הראש. שמור על מרפקים קרובים לראש, כופף את המרפקים והורד את המשקולת מאחורי הראש, ואז ישר את הידיים מעלה תוך כיווץ הטרייספס.'
        WHERE id = exercise_record.id;
      
      -- בטן
      WHEN 'כפיפות בטן' THEN
        UPDATE exercises SET instructions = 'שכב על הגב, ברכיים כפופות וכפות רגליים על הרצפה. שים ידיים לצד הראש או על החזה, כווץ את שרירי הבטן והרם את השכמות מהרצפה לכיוון הברכיים מבלי למשוך בצוואר, ואז חזור באיטיות מטה.'
        WHERE id = exercise_record.id;
      
      WHEN 'פלאנק' THEN
        UPDATE exercises SET instructions = 'כוון את המרפקים מתחת לכתפיים וכפות רגליים על הרצפה. הרם את הגוף לקו ישר מהראש עד העקבים, כווץ את הבטן והישבן ושמור על גב נייטרלי. החזק את התנוחה למשך הזמן הנדרש בלי לקרוס במותן.'
        WHERE id = exercise_record.id;
      
      WHEN 'הנפות רגליים בתלייה' THEN
        UPDATE exercises SET instructions = 'תלה ממוט, רגליים ישרות או מעט כפופות. שמור על גב יציב, הרם את הרגליים קדימה עד גובה אגן או גבוה יותר תוך כיווץ הבטן, ואז הורד באיטיות מבלי להתנדנד.'
        WHERE id = exercise_record.id;
      
      WHEN 'גלגל בטן' THEN
        UPDATE exercises SET instructions = 'כרע על הרצפה עם גלגל בטן מולך. גלגל את הגלגל קדימה תוך שמירה על גב נייטרלי ובטן מכווצת, התקרב קרוב ככל שניתן לרצפה בלי לקרוס במותן, ואז משוך את הגלגל חזרה לכיוון הברכיים באמצעות שרירי הבטן.'
        WHERE id = exercise_record.id;
      
      WHEN 'כפיפות בטן בשיפוע שלילי' THEN
        UPDATE exercises SET instructions = 'שכב על ספסל בשיפוע שלילי, רגליים מקובעות. ידיים לצד הראש או על החזה, כווץ את שרירי הבטן והרם את הגו לכיוון הברכיים, ואז הורד לאט מטה תוך שליטה מלאה ולא לתת לגב ''ליפול'' אחורה.'
        WHERE id = exercise_record.id;
      
      -- עכוז
      WHEN 'היפ תראסט' THEN
        UPDATE exercises SET instructions = 'שב על הרצפה כשהגב העליון נשען על ספסל, מוט מונח מעל הירכיים. כופף ברכיים, כפות רגליים שטוחות ברוחב אגן. דחוף את המוט מעלה על ידי הרמת האגן עד שקו ישר נוצר בין ברכיים-אגן-כתפיים, כווץ חזק את העכוז והורד לאט מטה.'
        WHERE id = exercise_record.id;
      
      WHEN 'גשר ירכיים' THEN
        UPDATE exercises SET instructions = 'שכב על הגב, כפות רגליים קרובות לעכוז. דחוף את האגן מעלה תוך כיווץ העכוז והירך האחורית עד שקו ישר נוצר בין ברכיים-אגן-כתפיים, החזק שנייה למעלה והורד לאט חזרה.'
        WHERE id = exercise_record.id;
      
      WHEN 'היפ אבדקשן' THEN
        UPDATE exercises SET instructions = 'שב במכונה או עמוד עם גומייה סביב הירכיים. שמור על גב ישר וברכיים מעט כפופות, פתח את הברכיים החוצה כנגד ההתנגדות תוך כיווץ שרירי העכוז הצדי, והחזר באיטיות פנימה מבלי לאבד מתח.'
        WHERE id = exercise_record.id;
      
      WHEN 'קיקבק בכבל' THEN
        UPDATE exercises SET instructions = 'חבר רצועה לקרסול בפולי תחתון. עמוד כשגוף יציב, החזק במוט לתמיכה. בעמדה של 90° בירך, בעט את הרגל לאחור ולמעלה תוך כיווץ העכוז, ואז החזר את הרגל באיטיות לנקודת ההתחלה מבלי לתת למשקל למשוך אותך קדימה.'
        WHERE id = exercise_record.id;
      
      ELSE
        -- אם התרגיל לא מזוהה, נוסיף הוראה כללית
        UPDATE exercises SET instructions = 'בצע את התרגיל בצורה מבוקרת, שמור על טכניקה נכונה ונשימה סדירה. אם אינך בטוח בביצוע התרגיל, התייעץ עם מאמן מוסמך.'
        WHERE id = exercise_record.id;
    END CASE;
    
    RAISE NOTICE 'הוספתי הוראות לתרגיל: %', exercise_record.name;
  END LOOP;
  
  -- ספירת תרגילים שעודכנו
  SELECT COUNT(*) INTO exercise_count
  FROM exercises e
  JOIN muscle_groups mg ON e.muscle_group_id = mg.id
  WHERE mg.trainer_id IS NULL
  AND e.instructions IS NOT NULL
  AND e.instructions != '';
  
  RAISE NOTICE 'סה"כ תרגילים עם הוראות: %', exercise_count;
END $$;
